<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <title>Fotogaléria</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.3/dragula.min.css"
          integrity="sha512-zlYhSecphd+kwRzeCOyj7/u3HZIQ3Q0NP7AN7ZEKhYTdi0AQOGGbc7eA3I/mUffqjdr8G1/9xoS478h+I0MQGg=="
          crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.3/dragula.min.js" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="css/style.css">
    <!--<script src="https://cdn.jsdelivr.net/npm/@shopify/draggable@1.0.0-beta.11/lib/draggable.bundle.js"></script>-->

   <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
-->
</head>
<body>

<header>
    <h1>Slovenské vrchy</h1>
</header>

<div class="filter-container">

    <h2>Filter obrázkov:</h2>
    <label>
       <input id="filter" type="text">
    </label>
</div>

<section id="galeria-container">
    <br>
</section>

<div class="backdrop">


    <div class="modal-okno fade"></div>
    <a class="prev">&#10094;</a>
    <a class="next">&#10095;</a>

    <div id="modal-pod-obrazkom">

        <div class="info-container">

            <h3 id="title">Názov:</h3>
            <div class="ml3">
                <span id="nazov-obrazka"></span>
            </div>

            <h3>Popis:</h3>
            <div class="ml3">
                <span id="popis-obrazka"></span>
            </div>

        </div>
        <button type="button" id="slideshow-button" onclick="switchButtons('stop-slideshow-button','slideshow-button')">SlideShow</button>
        <button type="button" id="button-close">Zavrieť</button>
        <button type="button" id="stop-slideshow-button" onclick="switchButtons('slideshow-button','stop-slideshow-button')">Ukončiť slideShow</button>
        <br>
    </div>

</div>

<footer>
    <hr>
    <br>
    <span>© 2021, Marián Figula</span>

</footer>


<script>
    // todo - dat switchbutton on click do js

    const section = document.querySelector("section");
    const filter = document.querySelector("#filter");
    const backdrop = document.querySelector(".backdrop")
    const modal = document.querySelector(".modal-okno");
    const nazovObrazka = document.getElementById("nazov-obrazka");
    const popisObrazka = document.getElementById("popis-obrazka");
    const buttonClose = document.getElementById("button-close");
    const modalPodObrazkom = document.getElementById("modal-pod-obrazkom");
    const infoContainer = document.querySelector(".info-container");
    const slideShowButton = document.getElementById("slideshow-button");
    const stopSlideShowButton = document.getElementById("stop-slideshow-button");
    const nextImage = document.querySelector(".next");
    const prevImage = document.querySelector(".prev");

//----------------------------------------------------------//

    const galeria = document.getElementById("galeria-container")
    var pomocnePole = []
    var pomocnePole2 = []
    //pomocnePole.push(galeria);
    //console.log("pomocnePole",pomocnePole)

    var pole = []
    var displayedImageSrc;
    var displayedImage;
    var animate;
    var index;
    var startAnimation = false;

    //pomocnePole.push(galeria)


    dragula([document.querySelector("#galeria-container")])
        .on('drop', function (el) {
            pomocnePole = []
            var children = galeria.children;
            for (let i = 0; i < children.length; i++) {
                var child = children[i];
                //console.log(child.getAttribute("src"));
                pomocnePole.push(child.getAttribute("src"));
            }

            //localStorage.removeItem("filenames")
            localStorage.setItem("filenames", JSON.stringify(pomocnePole))

            //console.log("---------------ZMENENE POLE -------------")
            for (let i = 0; i < pomocnePole.length; i++) {
                for (let j = 0; j < pole.length; j++) {
                    if (pomocnePole[i] === `./images/${pole[j].filename}`){
                //        console.log("skocil som do ifu")
                        let tmp = pole[i]
                        pole[i] = pole[j]
                        pole[j] = tmp;
                    }
                }
            }
            console.log(pole)
        })

    buttonClose.addEventListener("click", () =>{
        startAnimation = false;
        stopSlideShow();
        backdrop.style.display = "none";
    })

    const filterValue = localStorage.getItem("filter") == null ? "" : localStorage.getItem("filter");
    filter.value = filterValue;

    filter.addEventListener("input", event => {
        loadImages(event.target.value)
    })


    const loadImages = (filterString) => {
        let i = 0;
        localStorage.setItem("filter", filterString);
        section.innerHTML = '';

        fetch("./images.json")
            .then(res => res.json())
            .then(data => { // data - cely subor
                //console.log(data)
                pole = [];
                data.forEach(image => {

                    nazovObrazka.innerText = ""
                    popisObrazka.innerText = ""

                    if (image.title.toLowerCase().indexOf(filterString) !== -1 ||
                        image.title.toUpperCase().indexOf(filterString) !== -1 ||
                        image.title.indexOf(filterString) !== -1)
                    {
                        //console.log(image); // for po jednom objekte
                        pole.push(image)
                        const thumbnail = document.createElement("img");
                        thumbnail.src = pomocnePole[i] // TODO
                        i++;
                        thumbnail.height = 240;
                        thumbnail.width = 240;
                        thumbnail.style.objectFit = "cover";
                        thumbnail.addEventListener("click", () => {
                            backdrop.style.display = "block";
                            modal.innerHTML = "";
                            const modalImage = document.createElement("img")
                            modalImage.src = `./images/${image.filename}`
                            modalImage.style.width = "100%";
                            modalImage.style.height = "100%";
                            modalImage.style.objectFit = "cover"

                            displayedImageSrc = image.filename;
                            displayedImage = modalImage;

                            modal.appendChild(modalImage);
                            nazovObrazka.innerText = `${image.title}`
                            popisObrazka.innerText = `${image.description}`
                        })
                        section.appendChild(thumbnail);


                    }
                })

                // pushujem do localStorage
                var children = galeria.children;

                for (let i = 0; i < children.length; i++) {
                    var child = children[i];
                    //console.log(child.getAttribute("src"));
                    pomocnePole.push(child.getAttribute("src"));
                }
                console.log(pomocnePole)
                localStorage.setItem("filenames", JSON.stringify(pomocnePole))
                //console.log(JSON.parse(localStorage.getItem("filenames")));
            })


    }
    loadImages(filterValue);

    function getIndex(){
        if (index == null){
            for (let i = 0; i < pole.length; i++) {
                if (pole[i].filename === displayedImageSrc) {
                    //console.log("zhoduje sa")
                    index = i;
                    break;
                }
            }
        }
    }


    nextImage.addEventListener("click", () => {
        getIndex();
        index++;
        //console.log("index - next image",index)
        slideShow();
        clearTimeout(animate);
    })

    prevImage.addEventListener("click", () => {
        getIndex();
        index--;
        //console.log("index previous image",index)
        clearTimeout(animate);
        slideShow();

    })

    slideShowButton.addEventListener("click", () => {
        getIndex();
        startAnimation = true;
        modalPodObrazkom.style.backgroundColor = "rgba(255,255,255,0.1)";
        infoContainer.style.display = "none";
        slideShow()
    })


    function slideShow(){
        //console.log("DISPLAYED IMAGE",displayedImage);
        //console.log("index",index)
        //console.log(pole);

        if (index >= pole.length){
            index = 0;
            //console.log("INDEX>0")
        }else if (index < 0){
            index = pole.length - 1;
        }

        displayedImage.style.display = "none";
        displayedImage = document.createElement("img")
        displayedImage.src = `./images/${pole[index].filename}`;

        nazovObrazka.innerText = pole[index].title;
        popisObrazka.innerText = pole[index].description;

        displayedImage.style.display = "block";
        displayedImage.style.width = "100%";
        displayedImage.style.height = "100%";
        displayedImage.style.objectFit = "cover"
        modal.appendChild(displayedImage);

        if (startAnimation === true){
            prevImage.style.display = "none"
            nextImage.style.display = "none"

            animate = setTimeout(slideShow, 2000);

            if (animate != null){
                index++;
            }
        }
    }

    stopSlideShowButton.addEventListener("click", () => {
        prevImage.style.display = "block"
        nextImage.style.display = "block"
        modalPodObrazkom.style.backgroundColor = "rgba(255,255,255,1)";
        stopSlideShow();
    });

    function stopSlideShow(){
        startAnimation = false;
        infoContainer.style.display = "block";
        modalPodObrazkom.style.backgroundColor = "rgba(255,255,255,1)";
        clearTimeout(animate);
    }


    function switchButtons(button1, button2){
        document.getElementById(button1).style.display = "inline-block";
        document.getElementById(button2).style.display = "none";
    }
</script>
</body>
</html>